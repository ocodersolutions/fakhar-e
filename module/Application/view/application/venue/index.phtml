<?php
echo $this->headScript()->appendFile($this->basePath() . '/assets/js/tree.jquery.js');
echo $this->headLink()->appendStylesheet($this->basePath() . '/assets/css/jqtree.css');

$listAttrValue = $this->listAttrValue;
?>

<div class="row" id="venue_style_page">
	<div class="venue_cat col-lg-2 col-lg-offset-1 col-sm-3">
	<!-- <div class="venue_cat_wrap"> -->
		<h5>Venues</h5>
		<div id="tree1"></div>
	<!-- </div> -->
		
	</div>
	<div class="venue_main_content col-lg-8 col-sm-9">
		<?php if(!$this->venue_name){ ?>
			<p>Please choose Venue</p>
		<?php } else { ?>
		<h3 class="row">Venue: <i>"<?php echo $this->venue_name ;?>"</i></h3>
		<?php 
		$style_arr = $this->style_attr;
		foreach( $style_arr as $style_name=>$style_attr ){?>
			<?php foreach ($style_attr as $styleId => $AtrrArr) { ?>
			<div class="row style_item">
				<div class="style_left col-lg-2 col-sm-2 ">
					<p><?php  echo $styleId ?></p>
				</div>
				
				<div class="style_des_right col-lg-7 col-sm-7 ">
					<div class="row">
						
						<?php foreach ($AtrrArr as $AtrrName => $Atrrvalue) {?>
							<div class="col-sm-3"><?php echo $AtrrName ?></div>
							<div class="col-sm-9" style="font-weight: normal;"><?php echo $Atrrvalue ?></div>
						<?php } ?>
					</div>	
				</div>
				<div class="style_des_right col-lg-2 col-sm-2 ">
					<input type="text" name="hiddenDelid" value="<?php echo $style_name?>">
					<button type="button" class="btn btn-danger" name="delstylevenue">Delete</button>
				</div>
				<?php }?>
			</div>
		<?php }?>
		<div class="row style_item" id="pick_style_row">
			<div class="style_left pick_style col-lg-5 col-sm-5">
				<p>Pick Styles</p>
				<select data-placeholder="Choose a country..." style="width:100%" class="chosen-select">
					<option selected disabled >Select</option>
					<?php foreach($listAttrValue as $strrid=>$attr ){ ?>
						<option value="<?php echo $attr;?>" data-styleId="<?php echo $strrid ?>"> <?php echo $attr;?></option>
					<?php }  ?>
				</select>
				<input type="hidden" id="getstyleid" name="hiddenStyleid" value="">
			</div>
			<div class="style_des_right col-lg-7 col-sm-7">
				<!-- <p>Color <span> Red ,Green</span></p>
				<p>Brand <span> Brand 1 ,Brand 2</span></p> -->
				<button type="button" class="btn-st-blue btn-primary" name="add_style" id="add_style">Add</button>
			</div>
		</div>
		<?php } ?>
	</div>
</div>
<script>
var data = [
    <?php 
		$data_tree = $this->data_tree;
		echo $data_tree;
	?>
];
$(function() {
	 pathname = window.location.pathname; 
	 
    $('#tree1').tree({
        data: data,
        selectable: true,
        closedIcon: $('<i class="fa fa-plus"/>'),
    	openedIcon: $('<i class="fa fa-minus"/>'),
        onCreateLi: function(node, $li) {
        	var a = $li.find('span')[0];
        	a.outerHTML = '<a href="' + node.url + '">' + a.outerHTML + '</a>';
        }
    });
    $(".chosen-select").chosen(); 
    $(".chosen-select").chosen().change(function(){
		selectedValue = $(this).find("option:selected").data('styleid');
		$("input[name='hiddenStyleid']").val(selectedValue);
	});
    $(".venue_cat_wrap h5").click(function(){
    	$(this).parent('.venue_cat_wrap').toggleClass('open');
    	
    });
    tagA=$("#tree1").find("a[href='"+pathname+"']");
    tagA.find("span").css("color","#859ed8");
    li1=tagA.closest('li');
    ul1=li1.closest('ul');
	if(ul1.attr("display","none"))
	{
		ul1.css("display","block");
	}
	
    	

 //    if(tagA.indexOf("/venue/2")>0)
	// {
	// 	$this=tagA;
 //    	$this.css("background","red");
	// }
    
});
$(function() {
	$("#add_style").click(function(event) {
		styleid = $("input[name='hiddenStyleid']").val();
		venueid = '<?php echo $this->venue_id;?>';
		$.ajax({
			url : "/venue/savestylevenue",
	        type : "post",
	        dataType:"text",
	        data : {
	            'styleId' : styleid,
	            'venueid' : venueid,
	        },
	        success:function(){
	        	location.reload();
	        }
		});
	});

	//delete stylevenue
	$("button[name='delstylevenue']").click(function(){
		delstId = $(this).parent('.style_des_right').find("input[name='hiddenDelid']").val();
		venueId = '<?php echo $this->venue_id;?>';
		alert(delstId);
		$.ajax({
			url : "/venue/delstylevenue",
	        type : "post",
	        dataType:"text",
	        data : {
	            'delstId' : delstId,
	            'venueId' :venueId,
	        },
	        success:function(){
	        	location.reload();
	        }
		});
	})
});
</script>
