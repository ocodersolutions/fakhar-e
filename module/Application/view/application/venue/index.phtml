<?php
echo $this->headScript()->appendFile($this->basePath() . '/assets/js/tree.jquery.js');
echo $this->headLink()->appendStylesheet($this->basePath() . '/assets/css/jqtree.css');

$listAttrValue = $this->listAttrValue;
?>

<div class="row" id="venue_style_page">
	<div class="venue_cat col-lg-2 col-lg-offset-1 col-sm-3">
	<!-- <div class="venue_cat_wrap"> -->
		<h5>Venues</h5>
		<div id="tree1"></div>
	<!-- </div> -->
		
	</div>
	<div class="venue_main_content col-lg-8 col-sm-9">
		<?php if(!$this->venue_name){ ?>
			<p>Please choose Venue</p>
		<?php } else { ?>
			<div class="row style_item" id="pick_style_row">
			<div class="style_left pick_style col-lg-5 col-sm-5">
				<p>Pick Styles</p>
				<select data-placeholder="Choose a country..." style="width:100%" class="chosen-select">
					<option selected disabled >Select</option>
					<?php foreach($listAttrValue as $strrid=>$attr ){ ?>
						<option value="<?php echo $attr;?>" data-styleId="<?php echo $strrid ?>"> <?php echo $attr;?></option>
					<?php }  ?>
				</select>
				<input type="hidden" id="getstyleid" name="hiddenStyleid" value="">
			</div>
			<div class="style_des_right col-lg-7 col-sm-7">
				<!-- <p>Color <span> Red ,Green</span></p>
				<p>Brand <span> Brand 1 ,Brand 2</span></p> -->
				<button type="button" class="btn-st-blue btn-primary" name="add_style" id="add_style">Add</button>
			</div>
		</div>
		<p class="tree_title">My styles</p>
		<h3 class="row">Venue: <i>"<?php echo $this->venue_name ;?>"</i></h3>

		<?php 
		$style_arr = $this->style_attr;
		if(empty($style_arr)){
			echo "<i>please add style for Venue</i>";
		}
		foreach( $style_arr as $style_name=>$style_attr ){?>
			<?php foreach ($style_attr as $styleId => $AtrrArr) { ?>
			<div class="row style_item">
				<div class="style_left col-lg-2 col-sm-2 ">
					<p><?php  echo $styleId ?></p>
				</div>
				
				<div class="style_des_right col-lg-7 col-sm-7 ">
					<div class="row">
						
						<?php foreach ($AtrrArr as $AtrrName => $Atrrvalue) {?>
							<div class="col-sm-5"><?php echo $AtrrName ?></div>
							<div class="col-sm-7" style="font-weight: normal;"><?php echo $Atrrvalue ?></div>
						<?php } ?>
					</div>	
				</div>
				<div class="style_des_right col-lg-2 col-sm-2 ">
					<input type="hidden" name="hiddenDelid" value=<?php echo $style_name?>">
					<button type="button" class="btn btn-danger" name="delstylevenue">Delete</button>
				</div>
				<?php }?>
			</div>
		<?php }?>
		<?php } ?>
		<!-- start parent -->
		<?php $parentArr = $this->Parent_Arr;
			  $GrandParent_Arr = $this->GrandParent_Arr;
			  
			  if((!empty($parentArr)) || (!empty($parentArr))){
			  	echo "<p class='tree_title'>Parents styles</p>";
			  	if (!empty($parentArr)){
			  		echo '<h3>Immi diate Parent Venue</h3>';
			  		foreach ($parentArr as $parentkey => $parentvalue) { ?>
				  		<div class="row style_item">
							<div class="style_left col-lg-3 col-sm-3 ">
								<p><?php echo $parentkey ?></p>
							</div>
							
							<div class="style_des_right col-lg-8 col-sm-8 ">
								<div class="row">
									<?php if (is_array($parentvalue)){
										foreach ($parentvalue as $attrb => $attrbvalue) {?>
											<div class="col-sm-5"><?php echo $attrb?></div>
											<div class="col-sm-7" style="font-weight: normal;"><?php echo $attrbvalue?></div>
										<?php }
									}?>
									
									</div>	
							</div>
							
						</div>
				  	<?php }
			  	}
			  	if (!empty($GrandParent_Arr)){
			  		echo '<h3>Grand Parent Venue</h3>';
			  		foreach ($GrandParent_Arr as $GrandParentkey => $GrandParentvalue) { ?>
				  		<div class="row style_item">
							<div class="style_left col-lg-3 col-sm-3 ">
								<p><?php echo $GrandParentkey ?></p>
							</div>
							
							<div class="style_des_right col-lg-8 col-sm-8 ">
								<div class="row">
									<?php if (is_array($GrandParentvalue)){
										foreach ($GrandParentvalue as $GrandParentattrb => $GrandParentattrbvalue) {?>
											<div class="col-sm-5"><?php echo $GrandParentattrb?></div>
											<div class="col-sm-7" style="font-weight: normal;"><?php echo $GrandParentattrbvalue?></div>
										<?php }
									}?>
									
									</div>	
							</div>
							
						</div>
				  	<?php }
			  	}
			  }
		?>
		<!-- end parent -->
		<!-- child -->
		<?php $ChildrenArr = $this->child_arr;
			if(!empty($ChildrenArr)){?>
				<p class="tree_title">Child styles</p>
				<h3>Immi diate Child Venue</h3>
				<?php foreach ($ChildrenArr as $name_venue => $venue_value) {?>
					<?php 
					if(!empty($venue_value)){
						foreach ($venue_value as $name_st => $attr_arr) {?>
							<div class="row style_item">
								<div class="style_left col-lg-3 col-sm-3 ">
									<p><?php echo $name_st ?></p>
								</div>
								
								<div class="style_des_right col-lg-8 col-sm-8 ">
									<div class="row">
										<?php if (is_array($attr_arr)){
											foreach ($attr_arr as $key => $value) {?>
												<div class="col-sm-5"><?php echo $key?></div>
												<div class="col-sm-7" style="font-weight: normal;"><?php echo $value?></div>
											<?php }
										}?>
										
										</div>	
								</div>
								
							</div>
						<?php }
					}
				}
			}?>
			<?php $GranChildrenArr = $this->GrandChild_Arr;
			//var_dump($GranChildrenArr);
				if (!empty($GranChildrenArr)){
					echo"<h3>Grand Child Venue</h3>";
					foreach ($GranChildrenArr as $nameGrChild => $GrChildvalue) { ?>
					<div class="row style_item">
						<div class="style_left col-lg-3 col-sm-3 ">
							<p><?php echo $nameGrChild ?></p>
						</div>
						<div class="style_des_right col-lg-8 col-sm-8 ">
							<div class="row">
						<?php if (is_array($GrChildvalue)){
							foreach ($GrChildvalue as $attrname => $attrvalue) {?>
								<div class="col-sm-5"><?php echo $attrname?></div>
								<div class="col-sm-7" style="font-weight: normal;"><?php echo $attrvalue ?></div>
						<?php	}
						}?>
							</div>	
						</div>
							
					</div>
					<?php }
				}
			?>

	</div>
</div>
<script>
var data = [
    <?php 
		$data_tree = $this->data_tree;
		echo $data_tree;
	?>
];
$(function() {
	 pathname = window.location.pathname; 
	 
    $('#tree1').tree({
        data: data,
        selectable: true,
        closedIcon: $('<i class="fa fa-plus"/>'),
    	openedIcon: $('<i class="fa fa-minus"/>'),
        onCreateLi: function(node, $li) {
        	var a = $li.find('span')[0];
        	a.outerHTML = '<a href="' + node.url + '">' + a.outerHTML + '</a>';
        }
    });
    $(".chosen-select").chosen(); 
    $(".chosen-select").chosen().change(function(){
		selectedValue = $(this).find("option:selected").data('styleid');
		$("input[name='hiddenStyleid']").val(selectedValue);
	});
    $(".venue_cat_wrap h5").click(function(){
    	$(this).parent('.venue_cat_wrap').toggleClass('open');
    	
    });
    tagA=$("#tree1").find("a[href='"+pathname+"']");
    tagA.find("span").css("color","#859ed8");
    $this=tagA.find("span");
    if($this.attr('aria-level')==3)
    {
    	li2=$this.closest('li.jqtree_common .jqtree-folder');
    	if(li2.hasClass('jqtree-closed')){
    		li2.removeClass('jqtree-closed');
    		li2.addClass('123');
    		li2.find('div.jqtree_common').find('a.jqtree-toggler').removeClass('jqtree-closed');
    		li2.find('div.jqtree_common').find('a.jqtree-toggler').find('i.fa').removeClass('fa-plus');
    		li2.find('div.jqtree_common').find('a.jqtree-toggler').find('i.fa').addClass('fa-minus');
    	}
    	ul2=li2.closest('ul');
    	if(ul2.attr('display','none')){
    		ul2.css('display','block');
    	}
    	li1=ul2.closest('li');
    	if(li1.hasClass('jqtree-closed')){
    		li1.removeClass('jqtree-closed');
    		li1.find('div.jqtree_common').find('a.jqtree-toggler').find('i.fa').removeClass('fa-plus');
    		li1.find('div.jqtree_common').find('a.jqtree-toggler').find('i.fa').addClass('fa-minus');
    	}
    	$this.closest('li.jqtree_common .jqtree-folder').find('ul').css('display','block');
    	//$this.closest('li.jqtree_common .jqtree-folder').find('ul').addClass('class_name');
    }else if ($this.attr('aria-level')==2)
    {
    	ul1=$this.closest('ul');
    	if(ul1.attr('display','none')){
    		ul1.css('display','block');
    	}
    	li1=ul1.closest('li');
    	if(li1.hasClass('jqtree-closed')){
    		li1.removeClass('jqtree-closed');
    		li1.find('div.jqtree_common').find('a.jqtree-toggler').first().find('i.fa:first-child').removeClass('fa-plus');
    		li1.find('div.jqtree_common').find('a.jqtree-toggler').first().find('i.fa:first-child').addClass('fa-minus');
    	}
    	
    }
});
$(function() {
	$("#add_style").click(function(event) {
		styleid = $("input[name='hiddenStyleid']").val();
		venueid = '<?php echo $this->venue_id;?>';
		$.ajax({
			url : "/venue/savestylevenue",
	        type : "post",
	        dataType:"text",
	        data : {
	            'styleId' : styleid,
	            'venueid' : venueid,
	        },
	        success:function(result){
	        	console.log(result);
	        	if(result!=1){
	        		//myalert('myalertid1','type_missing','Oops', 'Style alredy exits.','');
	        		myalert('alert_idNewsLetterInput3','type_missing','Ooops!','','OK','Style alredy exits.',function(){$('#alert_idNewsLetterInput3').foundation('reveal','close'); });
	        	}else{
	        		location.reload();
	        	}
	        }
		});
	});

	//delete stylevenue
	$("button[name='delstylevenue']").click(function(){
		delstId = $(this).parent('.style_des_right').find("input[name='hiddenDelid']").val();
		venueId = '<?php echo $this->venue_id;?>';
		alert(delstId);
		$.ajax({
			url : "/venue/delstylevenue",
	        type : "post",
	        dataType:"text",
	        data : {
	            'delstId' : delstId,
	            'venueId' :venueId,
	        },
	        success:function(){
	        	location.reload();
	        }
		});
	})
});
</script>
